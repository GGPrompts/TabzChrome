(function(){console.log("Terminal Tabs content script loaded");function u(){if(window.location.hostname!=="github.com")return null;const n=window.location.pathname.match(/^\/([^/]+)\/([^/]+)/);if(n){const[,e,r]=n,t=r.replace(/\.git$/,"");return{owner:e,repo:t,fullName:`${e}/${t}`}}return null}function d(){if(window.location.hostname!=="gitlab.com")return null;const n=window.location.pathname.match(/^\/([^/]+)\/([^/]+)/);if(n){const[,e,r]=n,t=r.replace(/\.git$/,"");return{owner:e,repo:t,fullName:`${e}/${t}`}}return null}function p(){const n=u(),e=d();n&&(console.log("GitHub repo detected:",n.fullName),document.addEventListener("contextmenu",r=>{chrome.runtime.sendMessage({type:"ADD_CONTEXT_MENU",items:[{id:"clone-github-repo",title:`Clone ${n.fullName}`,action:()=>{chrome.runtime.sendMessage({type:"SPAWN_TERMINAL",command:`git clone https://github.com/${n.fullName}.git`,cwd:"~/projects"})}}]})})),e&&(console.log("GitLab repo detected:",e.fullName),document.addEventListener("contextmenu",r=>{chrome.runtime.sendMessage({type:"ADD_CONTEXT_MENU",items:[{id:"clone-gitlab-repo",title:`Clone ${e.fullName}`,action:()=>{chrome.runtime.sendMessage({type:"SPAWN_TERMINAL",command:`git clone https://gitlab.com/${e.fullName}.git`,cwd:"~/projects"})}}]})}))}const g=[{pattern:/command not found: (.+)/,getSuggestion:n=>{const e=n[1];return`Install ${e} using: sudo apt install ${e} or brew install ${e}`}},{pattern:/npm ERR! (.+)/,getSuggestion:()=>"Try: npm install or npm cache clean --force"},{pattern:/yarn error (.+)/,getSuggestion:()=>"Try: yarn install or rm -rf node_modules && yarn"},{pattern:/Permission denied/,getSuggestion:()=>"Try running with sudo or check file permissions"},{pattern:/ENOENT: no such file or directory/,getSuggestion:n=>"File or directory not found - check the path"},{pattern:/Port \d+ is already in use/,getSuggestion:n=>{const e=n[0].match(/Port (\d+)/);if(e){const r=e[1];return`Port ${r} in use. Find process: lsof -ti:${r} | xargs kill -9`}return"Port already in use - kill the process using it"}}];function f(){const n=["log","info","warn","error","debug"];for(const e of n){const r=console[e];console[e]=(...t)=>{r.apply(console,t);const i=t.map(o=>{if(typeof o=="string")return o;if(o instanceof Error)return`${o.name}: ${o.message}
${o.stack||""}`;try{return JSON.stringify(o,null,2)}catch{return String(o)}}).join(" ");let s;if(e==="error"){const o=t.find(m=>m instanceof Error);s=(o==null?void 0:o.stack)||new Error().stack}try{chrome.runtime.sendMessage({type:"CONSOLE_LOG",entry:{level:e,message:i,timestamp:Date.now(),url:window.location.href,tabId:-1,stack:s}}).catch(()=>{})}catch{}}}}function y(){const n=console.error;console.error=(...e)=>{n.apply(console,e);const r=e.map(t=>typeof t=="string"?t:JSON.stringify(t)).join(" ");for(const{pattern:t,getSuggestion:i}of g){const s=r.match(t);if(s){const o=i(s);chrome.runtime.sendMessage({type:"SHOW_ERROR_SUGGESTION",error:s[0],suggestion:o}).catch(()=>{});break}}}}function a(){document.querySelectorAll("[data-terminal-command]").forEach(e=>{if(e.hasAttribute("data-terminal-command-attached"))return;const r=e.getAttribute("data-terminal-command");if(!r)return;e.setAttribute("data-terminal-command-attached","true");const t=e;t.style.cursor,t.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),chrome.runtime.sendMessage({type:"QUEUE_COMMAND",command:r.trim()});const s=t.textContent,o=t.style.backgroundColor;t.style.backgroundColor="#4CAF50",t.textContent="✓ Queued!",setTimeout(()=>{t.textContent=s,t.style.backgroundColor=o},1e3)}),e.addEventListener("mouseenter",()=>{t.style.opacity="0.8"}),e.addEventListener("mouseleave",()=>{t.style.opacity="1"})})}function c(){document.querySelectorAll("pre code, code").forEach(e=>{var i;const r=e.textContent||"",t=[/^npm install/m,/^npm run/m,/^yarn install/m,/^yarn add/m,/^pnpm install/m,/^pnpm add/m];for(const s of t)if(s.test(r)){if(!((i=e.parentElement)!=null&&i.querySelector(".terminal-tabs-run-btn"))){const o=document.createElement("button");o.className="terminal-tabs-run-btn",o.textContent="▶ Run in Terminal",o.style.cssText=`
            position: absolute;
            top: 4px;
            right: 4px;
            padding: 4px 8px;
            font-size: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none;
          `,o.onclick=()=>{chrome.runtime.sendMessage({type:"QUEUE_COMMAND",command:r.trim()})},e.parentElement&&(e.parentElement.style.position="relative",e.parentElement.appendChild(o),e.parentElement.addEventListener("mouseenter",()=>{o.style.opacity="1",o.style.pointerEvents="auto"}),e.parentElement.addEventListener("mouseleave",()=>{o.style.opacity="0",o.style.pointerEvents="none"}))}break}})}function h(){document.addEventListener("keydown",n=>{(n.metaKey||n.ctrlKey)&&n.key==="k"&&(n.preventDefault(),chrome.runtime.sendMessage({type:"OPEN_POPUP"}))})}function l(){f(),p(),y(),c(),a(),h(),new MutationObserver(()=>{c(),a()}).observe(document.body,{childList:!0,subtree:!0}),console.log("✅ Terminal Tabs content script initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l();
})()
