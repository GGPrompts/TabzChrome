(function(){console.log("Terminal Tabs content script loaded");function u(){if(window.location.hostname!=="github.com")return null;const t=window.location.pathname.match(/^\/([^/]+)\/([^/]+)/);if(t){const[,e,r]=t,o=r.replace(/\.git$/,"");return{owner:e,repo:o,fullName:`${e}/${o}`}}return null}function m(){if(window.location.hostname!=="gitlab.com")return null;const t=window.location.pathname.match(/^\/([^/]+)\/([^/]+)/);if(t){const[,e,r]=t,o=r.replace(/\.git$/,"");return{owner:e,repo:o,fullName:`${e}/${o}`}}return null}function d(){const t=u(),e=m();t&&(console.log("GitHub repo detected:",t.fullName),document.addEventListener("contextmenu",r=>{chrome.runtime.sendMessage({type:"ADD_CONTEXT_MENU",items:[{id:"clone-github-repo",title:`Clone ${t.fullName}`,action:()=>{chrome.runtime.sendMessage({type:"SPAWN_TERMINAL",command:`git clone https://github.com/${t.fullName}.git`,cwd:"~/projects"})}}]})})),e&&(console.log("GitLab repo detected:",e.fullName),document.addEventListener("contextmenu",r=>{chrome.runtime.sendMessage({type:"ADD_CONTEXT_MENU",items:[{id:"clone-gitlab-repo",title:`Clone ${e.fullName}`,action:()=>{chrome.runtime.sendMessage({type:"SPAWN_TERMINAL",command:`git clone https://gitlab.com/${e.fullName}.git`,cwd:"~/projects"})}}]})}))}const p=[{pattern:/command not found: (.+)/,getSuggestion:t=>{const e=t[1];return`Install ${e} using: sudo apt install ${e} or brew install ${e}`}},{pattern:/npm ERR! (.+)/,getSuggestion:()=>"Try: npm install or npm cache clean --force"},{pattern:/yarn error (.+)/,getSuggestion:()=>"Try: yarn install or rm -rf node_modules && yarn"},{pattern:/Permission denied/,getSuggestion:()=>"Try running with sudo or check file permissions"},{pattern:/ENOENT: no such file or directory/,getSuggestion:t=>"File or directory not found - check the path"},{pattern:/Port \d+ is already in use/,getSuggestion:t=>{const e=t[0].match(/Port (\d+)/);if(e){const r=e[1];return`Port ${r} in use. Find process: lsof -ti:${r} | xargs kill -9`}return"Port already in use - kill the process using it"}}];function g(){const t=["log","info","warn","error","debug"];for(const e of t){const r=console[e];console[e]=(...o)=>{r.apply(console,o);const i=o.map(n=>{if(typeof n=="string")return n;if(n instanceof Error)return`${n.name}: ${n.message}
${n.stack||""}`;try{return JSON.stringify(n,null,2)}catch{return String(n)}}).join(" ");let s;if(e==="error"){const n=o.find(l=>l instanceof Error);s=(n==null?void 0:n.stack)||new Error().stack}try{chrome.runtime.sendMessage({type:"CONSOLE_LOG",entry:{level:e,message:i,timestamp:Date.now(),url:window.location.href,tabId:-1,stack:s}}).catch(()=>{})}catch{}}}}function f(){const t=console.error;console.error=(...e)=>{t.apply(console,e);const r=e.map(o=>typeof o=="string"?o:JSON.stringify(o)).join(" ");for(const{pattern:o,getSuggestion:i}of p){const s=r.match(o);if(s){const n=i(s);chrome.runtime.sendMessage({type:"SHOW_ERROR_SUGGESTION",error:s[0],suggestion:n}).catch(()=>{});break}}}}function c(){document.querySelectorAll("pre code, code").forEach(e=>{var i;const r=e.textContent||"",o=[/^npm install/m,/^npm run/m,/^yarn install/m,/^yarn add/m,/^pnpm install/m,/^pnpm add/m];for(const s of o)if(s.test(r)){if(!((i=e.parentElement)!=null&&i.querySelector(".terminal-tabs-run-btn"))){const n=document.createElement("button");n.className="terminal-tabs-run-btn",n.textContent="▶ Run in Terminal",n.style.cssText=`
            position: absolute;
            top: 4px;
            right: 4px;
            padding: 4px 8px;
            font-size: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 1000;
          `,n.onclick=()=>{chrome.runtime.sendMessage({type:"SPAWN_TERMINAL",command:r.trim()})},e.parentElement&&(e.parentElement.style.position="relative",e.parentElement.appendChild(n))}break}})}function h(){document.addEventListener("keydown",t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),chrome.runtime.sendMessage({type:"OPEN_POPUP"}))})}function a(){g(),d(),f(),c(),h(),new MutationObserver(()=>{c()}).observe(document.body,{childList:!0,subtree:!0}),console.log("✅ Terminal Tabs content script initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a();
})()
