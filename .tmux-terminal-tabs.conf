# Terminal Tabs - Tmux Configuration
# Optimized for spawning terminal sessions via xterm.js

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ฑ๏ธ  Mouse Support
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Enable mouse support - tmux handles terminal right-click, tabs get React menu
# This allows TUI tools (lazygit, vim, etc) to use their native context menus
set -g mouse on

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# โจ๏ธ   Prefix Key
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Use default Ctrl+B prefix (what most users expect)
# Uncomment below to change to Ctrl+A if you prefer:
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# โก Performance & Responsiveness
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# No escape delay (critical for vim/TUI apps)
set -sg escape-time 0

# Increase repeat time for repeatable commands
set -g repeat-time 600

# Focus events enabled for terminal-notifier
set -g focus-events on

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Scrollback & History
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Scrollback buffer (10k lines - balances history with emoji width stability)
set -g history-limit 10000

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐จ Colors & Display
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Use tmux-256color for modern terminal support (same as Windows Terminal config)
# This handles escape sequences better than screen-256color-bce
set -g default-terminal "tmux-256color"

# Enable true color (24-bit) support
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable xterm-style function keys (critical for proper key handling)
setw -g xterm-keys on

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ญ Status Bar
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Status bar at TOP to avoid conflicts with Claude Code's dynamic statusline at bottom
set -g status on
set -g status-position top

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐จ tmux2k Theme (via TPM)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin '2kabhishek/tmux2k'

# tmux2k settings
set -g @tmux2k-theme 'onedark'
set -g @tmux2k-icons-only false
set -g @tmux2k-left-plugins "git"
set -g @tmux2k-right-plugins "cpu ram time"
set -g @tmux2k-refresh-rate 5
set -g @tmux2k-window-list-alignment 'absolute-centre'

# tmux-yank settings
set -g @yank_selection_mouse 'clipboard'
set -g @override_copy_command 'sed "s/\x1b\[[0-9;]*m//g" | clip.exe'  # Strip ANSI, preserve Unicode

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ง Window & Pane Settings
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Start window numbering at 1 (instead of 0)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Don't rename windows automatically
set -g allow-rename off

# Activity monitoring (quiet mode)
setw -g monitor-activity off
set -g visual-activity off

# Pane border styling (prevents box art bleeding)
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour39
set -g pane-border-lines single

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Copy Mode (vim-like)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Use vi keys in copy mode
setw -g mode-keys vi

# Copy mode bindings (vim-like)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Aggressive Resize
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# DISABLED: aggressive-resize caused corruption when resizing sidebar with Claude Code running
# The rapid resize events conflicted with Claude Code's statusline calculations
setw -g aggressive-resize off
# NOTE: window-size uses default (latest) to match Windows Terminal behavior
# Previously had "smallest" which caused issues during refresh while working

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Clipboard Integration
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Enable clipboard integration (if available)
set -s set-clipboard on

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ฏ Quick Keys (Optional - for manual tmux use)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Reload config
bind r source-file ~/projects/TabzChrome/.tmux-terminal-tabs.conf \; display "Config reloaded!"

# Toggle mouse mode (Ctrl+B m)
bind m set -g mouse \; display "Mouse: #{?mouse,ON,OFF}"

# Re-enable mouse on client attach (fixes random disable during reconnects)
set-hook -g client-attached 'set -g mouse on'

# Quick window navigation
bind -n M-Left previous-window
bind -n M-Right next-window

# Tmuxplexer popup mode - Prefix + o
bind-key o run-shell "tmux popup -E -w 80% -h 80% -d '#{pane_current_path}' $HOME/projects/tmuxplexer/tmuxplexer --popup"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Bells & Notifications
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Disable bell
set -g visual-bell off
set -g bell-action none

# Display messages for 4 seconds (easier to read)
set -g display-time 4000

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐งน Session Management
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Destroy session when last window is closed (prevent orphans)
set -g destroy-unattached off

# Keep server running even if no sessions
set -g exit-empty off

# CRITICAL: Destroy panes when process exits (no [exited] message)
# This allows tabs to auto-close when you type 'exit' or Ctrl+D
set -g remain-on-exit off

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ง Xterm Rendering Fix
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# DISABLED: These hooks caused corruption when refreshing page while Claude Code working
# The refresh-client sends escape sequences during xterm.js reconnection, causing:
# - Raw ANSI escapes to print (terminal not ready)
# - Accidental copy mode entry (escapes misinterpreted as commands)
# - Screen region corruption near Claude Code's statusline
#
# Original intent was to fix split-pane rendering, but the side effects are worse.
# If you need to fix rendering after splits, manually run: tmux refresh-client
#
# set-hook -g after-select-pane 'run-shell "tmux refresh-client -c 2>/dev/null || true"'
# set-hook -g client-attached 'run-shell "tmux refresh-client -c 2>/dev/null || true"'
# set-hook -g pane-focus-in 'refresh-client -c'

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Initialize TPM (keep at bottom)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

run '~/.tmux/plugins/tpm/tpm'

